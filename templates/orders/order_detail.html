{% extends "base.html" %}

{% block title %}Commande #{{ order.pk }} – ShopDjango{% endblock %}

{% block content %}
<div class="row justify-content-center">
  <div class="col-lg-8">

    {% if order.paid %}
    <div class="alert alert-success d-flex align-items-center mb-4" role="alert">
      <i class="bi bi-check-circle-fill me-2 fs-4"></i>
      <div>
        Paiement confirmé ! Votre commande <strong>#{{ order.pk }}</strong> est en cours de traitement.
      </div>
    </div>
    {% else %}
    <div class="alert alert-warning d-flex align-items-center mb-4" role="alert">
      <i class="bi bi-hourglass-split me-2 fs-4"></i>
      <div>En attente de paiement pour la commande <strong>#{{ order.pk }}</strong>.</div>
    </div>
    {% endif %}

    <div class="card shadow-sm mb-4">
      <div class="card-header bg-dark text-white fw-bold d-flex justify-content-between">
        <span><i class="bi bi-receipt"></i> Récapitulatif commande #{{ order.pk }}</span>
        <span class="badge {% if order.paid %}bg-success{% else %}bg-warning text-dark{% endif %}">
          {{ order.get_status_display }}
        </span>
      </div>
      <div class="card-body">
        <!-- Infos livraison -->
        <h6 class="fw-bold mb-2">Livraison à :</h6>
        <p class="mb-1">{{ order.first_name }} {{ order.last_name }}</p>
        <p class="mb-1 text-muted">{{ order.address }}</p>
        <p class="mb-3 text-muted">{{ order.postal_code }} {{ order.city }}</p>
        <p class="text-muted small">E-mail : {{ order.email }}</p>
        <hr>

        <!-- Articles -->
        <h6 class="fw-bold mb-3">Articles :</h6>
        <table class="table table-bordered align-middle">
          <thead class="table-light">
            <tr>
              <th>Produit</th>
              <th>Prix unitaire</th>
              <th>Qté</th>
              <th>Total</th>
            </tr>
          </thead>
          <tbody>
            {% for item in order.items.all %}
            <tr>
              <td>{{ item.product.name }}</td>
              <td>{{ item.price }} €</td>
              <td>{{ item.quantity }}</td>
              <td class="fw-bold text-primary">{{ item.get_cost }} €</td>
            </tr>
            {% endfor %}
          </tbody>
          <tfoot>
            <tr class="table-dark">
              <td colspan="3" class="text-end fw-bold">Total commande</td>
              <td class="fw-bold fs-5">{{ order.get_total_cost }} €</td>
            </tr>
          </tfoot>
        </table>
      </div>
    </div>

    <!-- Simulation paiement -->
    {% if not order.paid %}
    <div class="card shadow-sm border-warning">
      <div class="card-header bg-warning fw-bold"><i class="bi bi-credit-card"></i> Payer maintenant (simulation)</div>
      <div class="card-body">
        <p class="text-muted">Cliquez sur le bouton ci-dessous pour simuler le paiement de cette commande.</p>
        <form method="post" action="{% url 'orders:order_pay' order.pk %}">
          {% csrf_token %}
          <button type="submit" class="btn btn-success btn-lg">
            <i class="bi bi-lock"></i> Simuler le paiement – {{ order.get_total_cost }} €
          </button>
        </form>
      </div>
    </div>
    {% endif %}

    <div class="mt-4 d-flex gap-3">
      <a href="{% url 'orders:order_list' %}" class="btn btn-outline-dark">
        <i class="bi bi-list-ul"></i> Mes commandes
      </a>
      <a href="{% url 'store:product_list' %}" class="btn btn-dark">
        <i class="bi bi-shop"></i> Continuer mes achats
      </a>
    </div>

  </div>
</div>
{% endblock %}
